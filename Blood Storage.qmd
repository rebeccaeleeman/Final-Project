---
title: "Blood Storage"
format: pdf
editor: visual
---

One way anova test 
Assumptions 
1) The samples are independent. 

This assumption is reasonably met by the nature of the data. Each sample represents and independent individual patient. Any condtions for one patient would not impact the conditions of another patient. 

2) Outcomes within groups are normally distributed 
```{r}
library(tidyverse)
blood <- read.csv("BloodStorage.csv")

library(ggplot2)
ggplot(data = blood, aes(x = TimeToRecurrence)) +
  geom_histogram(bins = 10) +
  facet_grid(~ RBC.Age.Group)

# Recode the numeric group variable into labeled factors
blood$RBC.Age.Group <- factor(blood$RBC.Age.Group,
                              levels = c(1, 2, 3),
                              labels = c("Younger", "Middle", "Older"))
```
This assumption is not met. Outcomes between groups of Blood Age (Younger, Middle, Older) are not normally distributed. Rather, they are right skewed in each group.  

3) The variance is the same within all groups

```{r, echo=FALSE}

ggplot(blood, aes(x = RBC.Age.Group, y = TimeToRecurrence, fill = RBC.Age.Group)) +
  geom_boxplot(alpha = 0.7, outlier.color = "red", outlier.shape = 16, outlier.size = 2) +
  theme_minimal() +
  labs(
    title = "Boxplot of Time to Recurrence across RBC Age Groups",
    x = "RBC Age Group",
    y = "Time to Recurrence (days)"
  ) +
  theme(legend.position = "none")

```
This assumption of anova is met. The variance across groups is nearly identical. 


```{r}

anova_result <- aov(TimeToRecurrence ~ RBC.Age.Group, data = blood)
summary(anova_result)


```
Linear regression 

Conditions: 

Independence: The independence condition appears to be met, as each observation in the Blood Storage dataset represents a separate patient, and thereâ€™s no indication that the measurements influence one another. Therefore, the residuals can reasonably be assumed to be independent.

Checking linearity and equal variance
```{r}

blood$AA <- factor(blood$AA, labels = c("Non-AA", "AA"))
blood$FamHx <- factor(blood$FamHx, labels = c("No", "Yes"))
blood$T.Stage <- factor(blood$T.Stage)
blood$bGS <- factor(blood$bGS)
blood$AnyAdjTherapy <- factor(blood$AnyAdjTherapy, labels = c("No", "Yes"))
blood$AdjRadTherapy <- factor(blood$AdjRadTherapy, labels = c("No", "Yes"))


lm_mod_full <- lm(TimeToRecurrence ~ RBC.Age.Group + Age + AA + FamHx + 
                    PVol + TVol + T.Stage + bGS + PreopPSA + Units + 
                    AnyAdjTherapy + AdjRadTherapy, data = blood)

lm_mod <- lm(TimeToRecurrence ~ RBC.Age.Group, data = blood)
summary(lm_mod)



ggplot(lm_mod_full, aes(x = .fitted, y = .resid)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(
    title = "Residuals vs Fitted",
    x = "Fitted Values",
    y = "Residuals"
  ) +
  theme_minimal()
```
Interpretation: INSERT SMTH HERE

Checking normality of residuals 


```{r}
ggplot(lm_mod_full, aes(.resid)) +
  geom_histogram(bins = 10, aes(y = ..density..)) +
  geom_density(color = "blue") +
  labs(title = "Histogram of Residuals")
```
Interpretation: Normality is not met, as the plot is right skewed with most residuals clustered near 0 and a longer tail extending to the right. This suggests that the residuals are not normally distributed. 


Running the regression 
```{r}

summary(lm_mod_full)

```
